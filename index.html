<!DOCTYPE html>
<html>
<head>

</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="scoreDisplay"></div>
<div id="instructions">Click to start!</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('scoreDisplay');
const instructions = document.getElementById('instructions');

let score = 0;
let gameStarted = false;
let playerX = 50;
let playerY = 50;
let playerSize = 20;
let enemyX = 700;
let enemyY = 300;
let enemySize = 20;
let enemySpeed = 2;
let minigameActive = false;

function drawPlayer() {
    ctx.fillStyle = 'red';
    ctx.fillRect(playerX, playerY, playerSize, playerSize);
}

function drawEnemy() {
    ctx.fillStyle = 'blue';
    ctx.fillRect(enemyX, enemyY, enemySize, enemySize);
}

function moveEnemy() {
    enemyX -= enemySpeed;
    if (enemyX < 0) {
        enemyX = 800;
        enemyY = Math.random() * 500;
        enemySpeed = Math.min(10, enemySpeed + 0.5);
    }
}

function checkCollision() {
    const playerRect = { x: playerX, y: playerY, width: playerSize, height: playerSize };
    const enemyRect = { x: enemyX, y: enemyY, width: enemySize, height: enemySize };

    if (
        playerRect.x < enemyRect.x + enemyRect.width &&
        playerRect.x + playerRect.width > enemyRect.x &&
        playerRect.y < enemyRect.y + enemyRect.height &&
        playerRect.y + playerRect.height > enemyRect.y
    ) {
        score += 10;
        enemyX = 800;
        enemyY = Math.random() * 500;
        enemySpeed = Math.min(10, enemySpeed + 0.5);
    }
}

function update() {
    if (!minigameActive && gameStarted) {
        moveEnemy();
        checkCollision();
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPlayer();
    drawEnemy();
    scoreDisplay.textContent = `Score: ${score}`;
}

function startGame() {
    gameStarted = true;
    instructions.style.display = 'none';
}

function extraAction() {
  if (gameStarted) {
   
    alert("Extra action! You win 5 points!");
    score += 5;
  }
}


function startMinigame() {
    minigameActive = true;
    
    let minigameScore = 0;
    let targetX = Math.random() * 700;
    let targetY = Math.random() * 500;
    
    function drawTarget() {
        ctx.fillStyle = 'green';
        ctx.fillRect(targetX, targetY, 20, 20);
    }

    function checkTargetHit(x, y) {
        if (
            x >= targetX &&
            x <= targetX + 20 &&
            y >= targetY &&
            y <= targetY + 20
        ) {
            minigameScore++;
            targetX = Math.random() * 700;
            targetY = Math.random() * 500;
        }
    }

    canvas.addEventListener('click', (event) => {
        checkTargetHit(event.offsetX, event.offsetY);
    });

    const minigameInterval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawPlayer();
        drawEnemy();
        drawTarget();
        scoreDisplay.textContent = `Score: ${score}`;
        if(minigameScore >= 5){
            minigameActive = false;
            clearInterval(minigameInterval);
            score += minigameScore * 2;
            alert("Minigame Complete! You earned points!")

        }
    }, 20);
}

canvas.addEventListener('click', (event) => {
    if (!gameStarted) {
        startGame();
    } else if (!minigameActive) {
        extraAction();
    } else {
      //already in minigame, do nothing
    }
});

setInterval(update, 20);
</script>

</body>
</html>
